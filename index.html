<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>H5P Game</title>
    <link rel="stylesheet" type="text/css" href="h5p-standalone/dist/styles/h5p.css">
    <script type="text/javascript" src="h5p-standalone/dist/js/h5p-standalone-main.min.js"></script>
    <style> body { margin: 0; padding: 0; } </style>
</head>
<body>
    <div id="h5p-container"></div>

    <script>
        const el = document.getElementById('h5p-container');
        
        // Cấu hình trỏ vào folder game đã giải nén
        const options = {
            h5pJsonPath: './my-game',
            frameJs: './h5p-standalone/dist/js/h5p-standalone-frame.min.js',
            frameCss: './h5p-standalone/dist/styles/h5p.css',
        };

        new H5PStandalone.H5P(el, options).then(function() {
            // Lắng nghe sự kiện xAPI khi game load xong
            if (window.H5P && window.H5P.externalDispatcher) {
                window.H5P.externalDispatcher.on('xAPI', function (event) {
                    
                    // Chỉ bắt sự kiện hoàn thành (completed)
                    if (event.getVerb() === 'completed') {
                        const score = event.getScore();
                        const maxScore = event.getMaxScore();

                        // Gửi message ra cửa sổ cha (SPFx)
                        window.parent.postMessage({
                            type: 'H5P_RESULT_SUBMISSION',
                            score: score,
                            maxScore: maxScore
                        }, '*'); // '*' để chấp nhận mọi domain cha, hoặc thay bằng domain sharepoint của bạn để bảo mật hơn
                    }
                });
            }
        });
    </script>
</body>
</html>